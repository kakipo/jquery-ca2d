(function(a){a.fn.ca2d=function(e){var h={cellSize:10,aliveColor:"#aaaaaa",deadColor:"#ffffff",fieldColor:"#ffffff",rule:function(l,k){var i=0;jQuery.each(k,function(m,n){i+=n});var j=l;if(l==1){if(i<=1||i>=4){j=0}}else{if(i==3){j=1}}return j},mutation:true};var f=a.extend({},h,e);return this.filter("canvas").each(function(){$this=a(this);if(!$this[0].getContext){return true}var i=$this.width();var l=$this.height();var k=new c(i,l,f.cellSize);var j=this.getContext("2d");g(j,k);var m=navigator.userAgent;if(m.search(/iPhone/)!=-1||m.search(/iPad/)!=-1){$this.on("touchstart touchmove touchend",function(n){n.preventDefault();g(j,k)})}else{$this.on("mousemove",function(n){g(j,k)})}});function g(i,j){b(j);d(i,j)}function b(l){for(var n=0;n<l.rows;n++){var v=l.cells[n];for(var m=0;m<l.cols;m++){var s=v[m];var k=l.cells[n-1<0?l.rows-1:n-1][m-1<0?l.cols-1:m-1];var w=l.cells[n-1<0?l.rows-1:n-1][m];var u=l.cells[n-1<0?l.rows-1:n-1][m+1>=l.cols?0:m+1];var t=l.cells[n][m-1<0?l.cols-1:m-1];var r=l.cells[n][m+1>=l.cols?0:m+1];var q=l.cells[n+1>=l.rows?0:n+1][m-1<0?l.cols-1:m-1];var p=l.cells[n+1>=l.rows?0:n+1][m];var o=l.cells[n+1>=l.rows?0:n+1][m+1>=l.cols?0:m+1];s.nextstate=f.rule(s.state,[k.state,w.state,u.state,t.state,r.state,q.state,p.state,o.state])}}}function d(m,p){for(var o=0;o<p.rows;o++){var q=p.cells[o];var r=o*p.cellSize;for(var n=0;n<p.cols;n++){var l=n*p.cellSize;var k=q[n];if(k.nextstate==1){m.fillStyle=k.color;m.fillRect(l,r,p.cellSize,p.cellSize)}else{m.clearRect(l,r,p.cellSize,p.cellSize)}k.state=k.nextstate}}}function c(r,q,k){this.x=r;this.y=q;this.cellSize=k;this.rows=Math.floor(q/k);this.cols=Math.floor(r/k);var s=new Array(this.rows);for(var p=0;p<this.rows;p++){var t=new Array(this.cols);for(var o=0;o<this.cols;o++){var l=Math.round(Math.random());var n=f.aliveColor;t[o]=new m(p,o,n,l)}s[p]=t}this.cells=s;function m(i,v,j,u){this.x=i;this.y=v;this.color=j;this.state=u;this.nextstate=u;this.extPeriod=0}}}})(jQuery);