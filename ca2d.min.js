(function(a){a.fn.ca2d=function(d){var f={cellSize:10,aliveColor:"#aaaaaa",deadColor:"#ffffff",fieldColor:"#ffffff",rule:function(k,h){var i=0;jQuery.each(h,function(l,m){i+=m});var j=k;if(k==1){if(i<=1||i>=4){j=0}}else{if(i==3){j=1}}return j},mutation:true};var e=a.extend({},f,d);return this.filter("canvas").each(function(){$this=a(this);if(!$this[0].getContext){return true}var h=$this.width();var j=$this.height();var l=new b(h,j,e.cellSize);g(l,e.rule);var i=this.getContext("2d");c(i,l);var k=navigator.userAgent;if(k.search(/iPhone/)!=-1||k.search(/iPad/)!=-1){this.ontouchstart=function(m){m.preventDefault();g(l,e.rule);c(i,l)};this.ontouchmove=function(m){m.preventDefault();g(l,e.rule);c(i,l)};this.ontouchend=function(m){m.preventDefault();g(l,e.rule);c(i,l)}}else{this.onmousemove=function(m){g(l,e.rule);c(i,l)}}});function g(m,q){for(var l=0;l<m.rows;l++){var v=m.cells[l];for(var k=0;k<m.cols;k++){var s=v[k];var h=m.cells[l-1<0?m.rows-1:l-1][k-1<0?m.cols-1:k-1];var w=m.cells[l-1<0?m.rows-1:l-1][k];var u=m.cells[l-1<0?m.rows-1:l-1][k+1>=m.cols?0:k+1];var t=m.cells[l][k-1<0?m.cols-1:k-1];var r=m.cells[l][k+1>=m.cols?0:k+1];var p=m.cells[l+1>=m.rows?0:l+1][k-1<0?m.cols-1:k-1];var o=m.cells[l+1>=m.rows?0:l+1][k];var n=m.cells[l+1>=m.rows?0:l+1][k+1>=m.cols?0:k+1];s.nextStatus=q(s.status,[h.status,w.status,u.status,t.status,r.status,p.status,o.status,n.status])}}}function c(l,q){for(var n=0;n<q.rows;n++){var o=q.cells[n];var p=n*q.cellSize;for(var m=0;m<q.cols;m++){var k=m*q.cellSize;var h=o[m];if(h.nextStatus==1){l.fillStyle=h.color;l.fillRect(k,p,q.cellSize,q.cellSize)}else{l.clearRect(k,p,q.cellSize,q.cellSize)}h.status=h.nextStatus}}}function b(q,p,h){this.x=q;this.y=p;this.cellSize=h;this.rows=Math.floor(p/h);this.cols=Math.floor(q/h);var r=new Array(this.rows);for(var o=0;o<this.rows;o++){var s=new Array(this.cols);for(var m=0;m<this.cols;m++){var n=Math.round(Math.random());var l=e.aliveColor;s[m]=new k(o,m,l,n)}r[o]=s}this.cells=r;function k(i,u,t,j){this.x=i;this.y=u;this.color=t;this.status=j;this.nextStatus=j;this.extPeriod=0}}}})(jQuery);